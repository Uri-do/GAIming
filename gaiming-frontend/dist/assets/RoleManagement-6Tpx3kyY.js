import{r as j,j as e,t as ae,k as ne,e as Q,i as te,U as re,K as le,S as ce}from"./index-B51ItZ5h.js";import{u as O}from"./useQuery-DhzND272.js";import{u as K}from"./useMutation-B0zsV7dG.js";import{B as I}from"./Button-CDIPLpLJ.js";import{I as B}from"./input-CPPgFB4q.js";import{B as y}from"./Badge-CFKe1Fd1.js";import{T as oe,a as de,b as U,c as f,d as me,e as g}from"./table-3EZ5XBfX.js";import{a as V,D as X,b as W,c as G,d as J,e as Y,F as Z,f as k,g as q,h as A,i as E,k as S,j as L,C as _,l as $,o as ee,m as se,s as D,S as xe,n as he,p as je,q as ue,r as pe,t as z}from"./switch-D_ncmqLh.js";import{C as v,a as w,b as C,c as R,d as fe}from"./Card-tTIaziEs.js";import{t as T}from"./index-CU4Ue5UX.js";import{u as P}from"./userManagementApi-CSBdIaOQ.js";import{u as ie}from"./index.esm-BK7_xKuE.js";import{X as ge}from"./x-circle-McNIoqAT.js";import{P as ye}from"./plus-zlnKERbv.js";import{M as Ne}from"./more-horizontal-CLkAnRld.js";import{P as be}from"./pen-square-DTpFLXc_.js";import{T as ve}from"./trash-2-BZVMjWbt.js";import"./x-BMU40GWQ.js";import"./api-DLjschmT.js";const H=j.forwardRef(({className:d,...p},t)=>e.jsx("textarea",{className:ae("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",d),ref:t,...p}));H.displayName="Textarea";const we=ee({name:D().min(1,"Role name is required").max(100,"Role name must be less than 100 characters"),description:D().max(500,"Description must be less than 500 characters").optional(),permissionIds:se(D()).optional()});function Ce({open:d,onOpenChange:p,onSuccess:t}){const[m,u]=j.useState([]),l=ie({resolver:V(we),defaultValues:{name:"",description:"",permissionIds:[]}}),{data:c=[],isLoading:x}=O({queryKey:["permissions"],queryFn:P.getPermissions}),h=K({mutationFn:n=>P.createRole(n),onSuccess:()=>{T.success("Role created successfully"),l.reset(),u([]),t()},onError:n=>{var s,i;T.error(((i=(s=n.response)==null?void 0:s.data)==null?void 0:i.message)||"Failed to create role")}}),o=n=>{h.mutate({...n,permissionIds:m})},F=n=>{u(s=>s.includes(n)?s.filter(i=>i!==n):[...s,n])},N=()=>{l.reset(),u([]),p(!1)},b=c.reduce((n,s)=>{const i=s.resource;return n[i]||(n[i]=[]),n[i].push(s),n},{});return e.jsx(X,{open:d,onOpenChange:N,children:e.jsxs(W,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(G,{children:[e.jsx(J,{children:"Create New Role"}),e.jsx(Y,{children:"Create a new role and assign permissions to control user access."})]}),e.jsx(Z,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(o),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Basic Information"}),e.jsx(k,{control:l.control,name:"name",render:({field:n})=>e.jsxs(q,{children:[e.jsx(A,{children:"Role Name"}),e.jsx(E,{children:e.jsx(B,{placeholder:"e.g., Content Manager",...n})}),e.jsx(S,{children:"A unique name for this role"}),e.jsx(L,{})]})}),e.jsx(k,{control:l.control,name:"description",render:({field:n})=>e.jsxs(q,{children:[e.jsx(A,{children:"Description"}),e.jsx(E,{children:e.jsx(H,{placeholder:"Describe what this role is for...",className:"resize-none",rows:3,...n})}),e.jsx(S,{children:"Optional description of the role's purpose"}),e.jsx(L,{})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Permissions"}),e.jsx(S,{children:"Select the permissions to assign to this role"}),x?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"})}):e.jsx("div",{className:"space-y-6",children:Object.entries(b).map(([n,s])=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:n}),e.jsxs(y,{variant:"outline",className:"text-xs",children:[s.length," permissions"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 pl-4",children:s.map(i=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{id:i.permissionId,checked:m.includes(i.permissionId),onCheckedChange:()=>F(i.permissionId)}),e.jsxs("label",{htmlFor:i.permissionId,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:i.action}),e.jsx(y,{variant:"secondary",className:"text-xs",children:i.action})]}),i.description&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:i.description})]})]},i.permissionId))})]},n))})]}),m.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Selected Permissions"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:m.map(n=>{const s=c.find(i=>i.permissionId===n);return s?e.jsxs(y,{variant:"secondary",className:"text-xs",children:[s.resource,".",s.action]},n):null})})]}),e.jsxs($,{children:[e.jsx(I,{type:"button",variant:"outline",onClick:N,children:"Cancel"}),e.jsx(I,{type:"submit",disabled:h.isPending,children:h.isPending?"Creating...":"Create Role"})]})]})})]})})}const Re=ee({name:D().min(1,"Role name is required").max(100,"Role name must be less than 100 characters"),description:D().max(500,"Description must be less than 500 characters").optional(),isActive:he(),permissionIds:se(D()).optional()});function Se({open:d,onOpenChange:p,role:t,onSuccess:m}){const[u,l]=j.useState([]),c=ie({resolver:V(Re),defaultValues:{name:t.name,description:t.description||"",isActive:t.isActive,permissionIds:[]}}),{data:x=[],isLoading:h}=O({queryKey:["permissions"],queryFn:P.getPermissions}),o=K({mutationFn:s=>P.updateRole(t.roleId,s),onSuccess:()=>{T.success("Role updated successfully"),m()},onError:s=>{var i,r;T.error(((r=(i=s.response)==null?void 0:i.data)==null?void 0:r.message)||"Failed to update role")}});j.useEffect(()=>{if(x.length>0&&t.permissions.length>0){const s=t.permissions.map(i=>i.permissionId);l(s)}},[x,t.permissions]),j.useEffect(()=>{c.reset({name:t.name,description:t.description||"",isActive:t.isActive})},[t,c]);const F=s=>{o.mutate({...s,permissionIds:u})},N=s=>{l(i=>i.includes(s)?i.filter(r=>r!==s):[...i,s])},b=()=>{p(!1)},n=x.reduce((s,i)=>{const r=i.resource;return s[r]||(s[r]=[]),s[r].push(i),s},{});return e.jsx(X,{open:d,onOpenChange:b,children:e.jsxs(W,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(G,{children:[e.jsx(J,{children:"Edit Role"}),e.jsx(Y,{children:"Update role information and permissions."})]}),e.jsx(Z,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(F),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Basic Information"}),e.jsx(k,{control:c.control,name:"name",render:({field:s})=>e.jsxs(q,{children:[e.jsx(A,{children:"Role Name"}),e.jsx(E,{children:e.jsx(B,{placeholder:"e.g., Content Manager",disabled:t.isSystemRole,...s})}),t.isSystemRole&&e.jsx(S,{children:"System role names cannot be changed"}),e.jsx(L,{})]})}),e.jsx(k,{control:c.control,name:"description",render:({field:s})=>e.jsxs(q,{children:[e.jsx(A,{children:"Description"}),e.jsx(E,{children:e.jsx(H,{placeholder:"Describe what this role is for...",className:"resize-none",rows:3,...s})}),e.jsx(L,{})]})}),e.jsx(k,{control:c.control,name:"isActive",render:({field:s})=>e.jsxs(q,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(A,{className:"text-base",children:"Active Role"}),e.jsx(S,{children:"When disabled, users with this role will lose its permissions"})]}),e.jsx(E,{children:e.jsx(xe,{checked:s.value,onCheckedChange:s.onChange,disabled:t.isSystemRole})})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Permissions"}),e.jsx(S,{children:"Select the permissions to assign to this role"}),h?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"})}):e.jsx("div",{className:"space-y-6",children:Object.entries(n).map(([s,i])=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s}),e.jsxs(y,{variant:"outline",className:"text-xs",children:[i.length," permissions"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 pl-4",children:i.map(r=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{id:r.permissionId,checked:u.includes(r.permissionId),onCheckedChange:()=>N(r.permissionId),disabled:t.isSystemRole}),e.jsxs("label",{htmlFor:r.permissionId,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:r.action}),e.jsx(y,{variant:"secondary",className:"text-xs",children:r.action})]}),r.description&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:r.description})]})]},r.permissionId))})]},s))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Role Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Role ID:"})," ",t.roleId]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Type:"})," ",t.isSystemRole?"System Role":"Custom Role"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Created:"})," ",new Date(t.createdDate).toLocaleDateString()]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Modified:"})," ",t.modifiedDate?new Date(t.modifiedDate).toLocaleDateString():"Never"]})]})]}),e.jsxs($,{children:[e.jsx(I,{type:"button",variant:"outline",onClick:b,children:"Cancel"}),e.jsx(I,{type:"submit",disabled:o.isPending,children:o.isPending?"Updating...":"Update Role"})]})]})})]})})}function Xe(){const[d,p]=j.useState(""),[t,m]=j.useState(null),[u,l]=j.useState(!1),[c,x]=j.useState(!1),h=ne(),{data:o=[],isLoading:F,error:N}=O({queryKey:["roles"],queryFn:P.getRoles}),b=K({mutationFn:P.deleteRole,onSuccess:()=>{h.invalidateQueries({queryKey:["roles"]}),T.success("Role deleted successfully")},onError:a=>{T.error(a.message||"Failed to delete role")}}),n=a=>{confirm("Are you sure you want to delete this role?")&&b.mutate(a)},s=a=>{m(a),x(!0)},i=a=>(typeof a=="string"?new Date(a):a).toLocaleDateString(),r=o.filter(a=>{var M;return a.name.toLowerCase().includes(d.toLowerCase())||((M=a.description)==null?void 0:M.toLowerCase().includes(d.toLowerCase()))});return N?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ge,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Error loading roles"}),e.jsx("p",{className:"text-gray-600",children:"Please try again later"})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Role Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage system roles and their permissions"})]}),e.jsxs(I,{onClick:()=>l(!0),children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Add Role"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs(v,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:"Total Roles"}),e.jsx(Q,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(R,{children:e.jsx("div",{className:"text-2xl font-bold",children:o.length})})]}),e.jsxs(v,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:"System Roles"}),e.jsx(te,{className:"h-4 w-4 text-blue-600"})]}),e.jsx(R,{children:e.jsx("div",{className:"text-2xl font-bold",children:o.filter(a=>a.isSystemRole).length})})]}),e.jsxs(v,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:"Custom Roles"}),e.jsx(re,{className:"h-4 w-4 text-green-600"})]}),e.jsx(R,{children:e.jsx("div",{className:"text-2xl font-bold",children:o.filter(a=>!a.isSystemRole).length})})]}),e.jsxs(v,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:"Total Permissions"}),e.jsx(le,{className:"h-4 w-4 text-purple-600"})]}),e.jsx(R,{children:e.jsx("div",{className:"text-2xl font-bold",children:o.reduce((a,M)=>a+M.permissions.length,0)})})]})]}),e.jsxs(v,{children:[e.jsx(w,{children:e.jsx(C,{children:"Search Roles"})}),e.jsx(R,{children:e.jsxs("div",{className:"relative",children:[e.jsx(ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(B,{placeholder:"Search roles...",value:d,onChange:a=>p(a.target.value),className:"pl-10"})]})})]}),e.jsxs(v,{children:[e.jsxs(w,{children:[e.jsx(C,{children:"Roles"}),e.jsxs(fe,{children:[r.length," roles found"]})]}),e.jsx(R,{children:F?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs(oe,{children:[e.jsx(de,{children:e.jsxs(U,{children:[e.jsx(f,{children:"Role"}),e.jsx(f,{children:"Description"}),e.jsx(f,{children:"Permissions"}),e.jsx(f,{children:"Type"}),e.jsx(f,{children:"Status"}),e.jsx(f,{children:"Created"}),e.jsx(f,{className:"text-right",children:"Actions"})]})}),e.jsx(me,{children:r.map(a=>e.jsxs(U,{children:[e.jsx(g,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",a.roleId.slice(0,8),"..."]})]})]})}),e.jsx(g,{children:e.jsx("div",{className:"max-w-xs truncate",children:a.description||"No description"})}),e.jsx(g,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:a.permissions.length}),e.jsx("span",{className:"text-sm text-gray-500",children:"permissions"})]})}),e.jsx(g,{children:e.jsx(y,{variant:a.isSystemRole?"default":"secondary",children:a.isSystemRole?"System":"Custom"})}),e.jsx(g,{children:e.jsx(y,{variant:a.isActive?"default":"secondary",children:a.isActive?"Active":"Inactive"})}),e.jsx(g,{children:i(a.createdDate)}),e.jsx(g,{className:"text-right",children:e.jsxs(je,{children:[e.jsx(ue,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"sm",children:e.jsx(Ne,{className:"h-4 w-4"})})}),e.jsxs(pe,{align:"end",children:[e.jsxs(z,{onClick:()=>s(a),children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Edit"]}),!a.isSystemRole&&e.jsxs(z,{onClick:()=>n(a.roleId),className:"text-red-600",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})})]},a.roleId))})]})})]}),e.jsx(Ce,{open:u,onOpenChange:l,onSuccess:()=>{h.invalidateQueries({queryKey:["roles"]}),l(!1)}}),t&&e.jsx(Se,{open:c,onOpenChange:x,role:t,onSuccess:()=>{h.invalidateQueries({queryKey:["roles"]}),x(!1),m(null)}})]})}export{Xe as default};
//# sourceMappingURL=RoleManagement-6Tpx3kyY.js.map
